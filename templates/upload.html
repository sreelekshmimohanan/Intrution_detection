{% load static %}
{% block content %}
{% include 'header.html' %}  
  
    <div id="contact" class="contact-us section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <h3 class="text-center mb-4">Upload CSV File for Intrusion Detection</h3>
          
          {% if not csv_preview %}
          <form id="contact" action="addfile" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row">
              <div class="col-lg-12">
                <fieldset>
                  <input type="file" name="file" id="file" accept=".csv" placeholder="Select CSV File" autocomplete="on" required>
                  <small class="form-text text-muted">Please upload a CSV file with network intrusion data</small>
                </fieldset>
              </div>
              <div class="col-lg-12">
                <fieldset>
                  <button type="submit" id="form-submit" class="main-button">Upload File</button>
                </fieldset>
              </div>
            </div>
          </form>
          {% endif %}

          {% if error %}
          <div class="alert alert-danger alert-dismissible fade show mt-4" role="alert">
            <strong>Error:</strong> {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endif %}

          {% if message %}
          <div class="alert alert-info alert-dismissible fade show mt-4" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endif %}

          {% if success_message %}
          <div class="alert alert-success alert-dismissible fade show mt-4" role="alert">
            {{ success_message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          <div class="text-center mt-3">
            <!--<a href="/v_addfile_user" class="btn btn-primary">View Your Predictions</a>-->
            <a href="/file" class="btn btn-secondary">Upload Another File</a>
          </div>
          {% endif %}

          {% if prediction %}
          <div class="alert {% if 'Anomaly' in prediction %}alert-danger{% else %}alert-success{% endif %} alert-dismissible fade show mt-4" role="alert">
            <h5 class="alert-heading">Prediction Result</h5>
            <strong>{{ prediction }}</strong>
            {% if prediction_details %}
            <hr>
            <p class="mb-0">{{ prediction_details }}</p>
            {% endif %}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endif %}

          {% if csv_preview %}
          <div class="card mt-4 shadow-sm">
            <div class="card-header bg-light">
              <h5 class="mb-0">CSV File Preview (First 20 Rows)</h5>
              <small class="text-muted">Total Rows: {{ csv_rows }} | Total Columns: {{ csv_columns }}</small>
            </div>
            <div class="card-body p-0">
              <div style="max-height: 500px; overflow-y: auto;">
                {{ csv_preview|safe }}
              </div>
            </div>
          </div>

          {% if show_predict_button %}
          <form action="predict_and_save" method="POST" class="mt-4 text-center">
            {% csrf_token %}
            <button type="submit" class="btn btn-success btn-lg">
              <i class="fas fa-brain"></i> Predict & Save to Database
            </button>
            <a href="/file" class="btn btn-secondary btn-lg">Cancel & Upload New File</a>
          </form>
          {% endif %}
          {% endif %}

        </div>
      </div>
    </div>
    <div class="contact-dec">
      <img src="{% static 'assets/images/contact-dec.png' %}" alt="">
    </div>
    <div class="contact-left-dec">
      <img src="{% static 'assets/images/contact-left-dec.png' %}" alt="">
    </div>
  </div>

  <style>
    .table {
      font-size: 12px;
    }
    .table th {
      background-color: #f8f9fa;
      position: sticky;
      top: 0;
      z-index: 10;
    }
  </style>

  {% endblock %}